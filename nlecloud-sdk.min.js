(function () {
    var b = "http://api.nlecloud.com"; var c = ""; function d(e, h, f, i, g) { e += (e.indexOf("?") > 0 ? "&" : "?") + "t=" + (new Date()).getTime(); if (f != null && f != undefined) { if (f == "") { console.log("请求" + e, { "Status": 1, "Msg": "AccessToken为空！" }); return } else { e += "&accesstoken=" + f } } e += "&jsoncallback=?"; i = i || {}; if (!g) { g = "GET" } $.ajax({ url: e, type: g, data: i, dataType: "json", success: function (j) { h(j) }, error: function (j) { console.log(j) } }) } function a() { } a.prototype = {
        userLogin: function (h, f, g) { var e; d(b + "/Jsonp/Login", function (i) { if (i.Status === 0) { c = i.ResultObj.AccessToken } e && e(i) }, null, { Account: h, Password: f, IsRememberMe: (g ? true : false) }, "POST"); return { completed: function (i) { e = i } } }, getProjectInfo: function (e) { var f; d(b + "/Projects/" + e, function (g) { f && f(g) }, c); return { completed: function (g) { f = g } } }, getProjects: function (f) { var e; var g = ""; if (f) { g += (f.Keyword ? ("Keyword=" + f.Keyword + "&") : ""); g += (f.ProjectTag ? ("ProjectTag=" + f.ProjectTag + "&") : ""); g += (f.NetWorkKind ? ("NetWorkKind=" + f.NetWorkKind + "&") : ""); g += (f.StartDate ? ("StartDate=" + encodeURIComponent(f.StartDate) + "&") : ""); g += (f.EndDate ? ("EndDate=" + encodeURIComponent(f.EndDate) + "&") : ""); g += (f.PageSize ? ("PageSize=" + f.PageSize + "&") : "PageSize=20&"); g += (f.PageIndex ? ("PageIndex=" + f.PageIndex + "&") : "PageIndex=1&") } d(b + "/Projects?" + g, function (h) { e && e(h) }, c); return { completed: function (h) { e = h } } }, getProjectSensors: function (e) { var g; if (!e) { throw "projectId 不能为空" } var f = b + "/Projects/" + e + "/Sensors"; d(f.format(gatewayTag), function (h) { g && g(h) }, c); return { completed: function (h) { g = h } } }, getDevicesDatas: function (e) { var g; if (!e) { e = "" } var f = b + "/Devices/Datas?devIds=" + e; d(f, function (h) { g && g(h) }, c); return { completed: function (h) { g = h } } }, getDevicesStatus: function (e) { var g; if (!e) { e = "" } var f = b + "/Devices/Status?devIds=" + e; d(f, function (h) { g && g(h) }, c); return { completed: function (h) { g = h } } }, getDeviceInfo: function (g) { var f; if (!g) { throw "deviceId 不能为空" } var e = b + "/Devices/" + g; d(e, function (h) { f && f(h) }, c); return { completed: function (h) { f = h } } }, getDevices: function (g) { var f; var h = ""; if (g) { h += (g.Keyword ? ("Keyword=" + g.Keyword + "&") : ""); h += (g.DeviceIds ? ("DeviceIds=" + g.DeviceIds + "&") : ""); h += (g.Tag ? ("Tag=" + g.Tag + "&") : ""); h += (g.IsOnline ? ("IsOnline=" + g.IsOnline + "&") : ""); h += (g.IsShare ? ("IsShare=" + g.IsShare + "&") : ""); h += (g.ProjectKeyWord ? ("ProjectKeyWord=" + g.ProjectKeyWord + "&") : ""); h += (g.StartDate ? ("StartDate=" + encodeURIComponent(g.StartDate) + "&") : ""); h += (g.EndDate ? ("EndDate=" + encodeURIComponent(g.EndDate) + "&") : ""); h += (g.PageSize ? ("PageSize=" + g.PageSize + "&") : "PageSize=20&"); h += (g.PageIndex ? ("PageIndex=" + g.PageIndex + "&") : "PageIndex=1&") } var e = b + "/Devices?" + h; d(e, function (i) { f && f(i) }, c); return { completed: function (i) { f = i } } }, addDevice: function (g) { var f; if (!g) { throw "device 不能为空" } var e = b + "/Jsonp?func=addDevice"; d(e, function (h) { if (h && h.Status == 0) { g.DeviceId = h.ResultObj } f && f(h) }, c, g, "POST"); return { completed: function (h) { f = h } } }, updateDevice: function (g) { var f; if (!g) { throw "device 不能为空" } if (!g.DeviceId) { throw "DeviceId 不能为空" } var e = b + "/jsonp?func=updateDevice"; d(e, function (h) { f && f(h) }, c, g, "PUT"); return { completed: function (h) { f = h } } }, deleteDevice: function (g) { var f; if (!g) { throw "deviceId 不能为空" } var e = b + "/jsonp?func=deleteDevice&deviceId=" + g; d(e, function (h) { f && f(h) }, c, null, "DELETE"); return { completed: function (h) { f = h } } }, getSensorInfo: function (h, g) { var f; if (!h) { throw "deviceId 不能为空" } if (!g) { throw "apiTag 不能为空" } var e = b + "/devices/" + h + "/Sensors/" + g; d(e, function (i) { f && f(i) }, c); return { completed: function (i) { f = i } } }, getSensors: function (h, e) { var g; if (!h) { throw "deviceId 不能为空" } var f = b + "/devices/" + h + "/Sensors?apiTags=" + e; d(f, function (i) { g && g(i) }, c); return { completed: function (i) { g = i } } }, addSensor: function (g) { var f; if (!g) { throw "sensor 不能为空" } if (!g.DeviceId) { throw "DeviceId 不能为空" } var e = b + "/jsonp?func=addSensor"; d(e, function (h) { f && f(h) }, c, g, "POST"); return { completed: function (h) { f = h } } }, updateSensor: function (g) { var f; if (!g) { throw "sensor 不能为空" } if (!g.DeviceId) { throw "DeviceId 不能为空" } if (!g.ApiTag) { throw "ApiTag 不能为空" } var e = b + "/jsonp?func=updateSensor"; d(e, function (h) { f && f(h) }, c, data, "PUT"); return { completed: function (h) { f = h } } }, deleteSensor: function (h, g) { var f; if (!h) { throw "DeviceId 不能为空" } if (!g) { throw "ApiTag 不能为空" } var e = b + "/jsonp?func=deleteSensor&deviceId=" + h + "&apiTag=" + g; d(e, function (i) { f && f(i) }, c, null, "DELETE"); return { completed: function (i) { f = i } } }, addSensorData: function (h, g) { var f; if (!h) { throw "DeviceId 不能为空" } if (!g) { throw "data 不能为空" } var e = b + "/jsonp?func=addSensorData&deviceId=" + h; d(e, function (i) { f && f(i) }, c, { DatasDTO: g }, "POST"); return { completed: function (i) { f = i } } }, getSensorData: function (g) {
            var f; if (!g) { throw "query 不能为空" } if (!g.DeviceId) { throw "DeviceId 不能为空" } var h = ""; h += (g.DeviceId ? ("DeviceId=" + g.DeviceId + "&") : ""); h += (g.ApiTags ? ("ApiTags=" + g.ApiTags + "&") : ""); h += (g.Method ? ("Method=" + g.Method + "&") : ""); h += (g.TimeAgo ? ("TimeAgo=" + g.TimeAgo + "&") : ""); h += (g.Sort ? ("Sort=" + g.Sort + "&") : ""); h += (g.StartDate ? ("StartDate=" + encodeURIComponent(g.StartDate) + "&") : ""); h += (g.EndDate ? ("EndDate=" + encodeURIComponent(g.EndDate) + "&") : ""); h += (g.PageSize ? ("PageSize=" + g.PageSize + "&") : "PageSize=20&"); h += (g.PageIndex ? ("PageIndex=" + g.PageIndex + "&") : "PageIndex=1&"); var e = b + "/devices/" + g.DeviceId + "/Datas?" + h;
            d(e, function (i) { f && f(i) }, c); return { completed: function (i) { f = i } }
        }, Cmds: function (i, g, h) { var f; var e = b + "/jsonp?func=Cmds&deviceId=" + i + "&apiTag=" + g; d(e, function (j) { f && f(j) }, c, { data: h }, "POST"); return { completed: function (j) { f = j } } }
    }; window.NLECloudAPI = a
})(); String.prototype.format = function (b) { var a = this; var e; if (arguments.length > 0) { if (arguments.length === 1 && typeof (b) === "object") { for (var d in b) { if (b.hasOwnProperty(d) && b[d] !== undefined) { e = new RegExp("({)" + d + "(})", "g"); a = a.replace(e, b[d]) } } } else { for (var c = 0; c < arguments.length; c++) { if (arguments[c] !== undefined) { e = new RegExp("({)" + c + "(})", "g"); a = a.replace(e, arguments[c]) } } } } return a };